diff -Nupr src.orig/net/ipv4/fib_frontend.c src/net/ipv4/fib_frontend.c
--- src.orig/net/ipv4/fib_frontend.c	2021-11-17 22:21:44.014307880 -0500
+++ src/net/ipv4/fib_frontend.c	2021-11-17 22:22:20.544366989 -0500
@@ -865,6 +865,7 @@ errout:
 	return err;
 }
 
+#include "kpatch-macros.h"
 static int inet_rtm_newroute(struct sk_buff *skb, struct nlmsghdr *nlh,
 			     struct netlink_ext_ack *extack)
 {
@@ -886,6 +887,7 @@ static int inet_rtm_newroute(struct sk_b
 	err = fib_table_insert(net, tb, &cfg, extack);
 	if (!err && cfg.fc_type == RTN_LOCAL)
 		net->ipv4.fib_has_custom_local_routes = true;
+	KPATCH_PRINTK("[inet_rtm_newroute]: err is %d\n", err);
 errout:
 	return err;
 }
diff -Nupr src.orig/net/ipv4/fib_semantics.c src/net/ipv4/fib_semantics.c
--- src.orig/net/ipv4/fib_semantics.c	2021-11-17 22:21:44.014307880 -0500
+++ src/net/ipv4/fib_semantics.c	2021-11-17 22:22:20.544366989 -0500
@@ -1344,6 +1344,7 @@ static bool fib_valid_prefsrc(struct fib
 	return true;
 }
 
+#include "kpatch-macros.h"
 struct fib_info *fib_create_info(struct fib_config *cfg,
 				 struct netlink_ext_ack *extack)
 {
@@ -1395,6 +1396,7 @@ struct fib_info *fib_create_info(struct
 #endif
 
 	err = -ENOBUFS;
+	KPATCH_PRINTK("[fib_create_info]: create error err is %d\n",err);
 	if (fib_info_cnt >= fib_info_hash_size) {
 		unsigned int new_size = fib_info_hash_size << 1;
 		struct hlist_head *new_info_hash;
@@ -1415,6 +1417,7 @@ struct fib_info *fib_create_info(struct
 		if (!fib_info_hash_size)
 			goto failure;
 	}
+	KPATCH_PRINTK("[fib_create_info]: 2 create error err is %d\n",err);
 
 	fi = kzalloc(struct_size(fi, fib_nh, nhs), GFP_KERNEL);
 	if (!fi)
@@ -1428,6 +1431,8 @@ struct fib_info *fib_create_info(struct
 	}
 
 	fib_info_cnt++;
+	KPATCH_PRINTK("[fib_create_info]: 3 create error err is %d\n",err);
+
 	fi->fib_net = net;
 	fi->fib_protocol = cfg->fc_protocol;
 	fi->fib_scope = cfg->fc_scope;
@@ -1454,13 +1459,18 @@ struct fib_info *fib_create_info(struct
 		if (cfg->fc_mp)
 			err = fib_get_nhs(fi, cfg->fc_mp, cfg->fc_mp_len, cfg,
 					  extack);
-		else
+		else {
+			KPATCH_PRINTK("[fib_create_info]: 4 create error err is %d\n",err);
 			err = fib_nh_init(net, fi->fib_nh, cfg, 1, extack);
+			KPATCH_PRINTK("[fib_create_info]: 5 create error err is %d\n",err);
+		}
 	}
 
 	if (err != 0)
 		goto failure;
 
+	KPATCH_PRINTK("[fib_create_info]: 6 create error err is %d\n",err);
+
 	if (fib_props[cfg->fc_type].error) {
 		if (cfg->fc_gw_family || cfg->fc_oif || cfg->fc_mp) {
 			NL_SET_ERR_MSG(extack,
@@ -1481,6 +1491,7 @@ struct fib_info *fib_create_info(struct
 			goto err_inval;
 		}
 	}
+	KPATCH_PRINTK("[fib_create_info]: 7 create error err is %d\n",err);
 
 	if (cfg->fc_scope > RT_SCOPE_HOST) {
 		NL_SET_ERR_MSG(extack, "Invalid scope");
@@ -1525,6 +1536,7 @@ struct fib_info *fib_create_info(struct
 		if (linkdown == fi->fib_nhs)
 			fi->fib_flags |= RTNH_F_LINKDOWN;
 	}
+	KPATCH_PRINTK("[fib_create_info]: 8 create error err is %d\n",err);
 
 	if (fi->fib_prefsrc && !fib_valid_prefsrc(cfg, fi->fib_prefsrc)) {
 		NL_SET_ERR_MSG(extack, "Invalid prefsrc address");
@@ -1538,6 +1550,7 @@ struct fib_info *fib_create_info(struct
 			if (nexthop_nh->fib_nh_gw_family == AF_INET6)
 				fi->fib_nh_is_v6 = true;
 		} endfor_nexthops(fi)
+		KPATCH_PRINTK("[fib_create_info]: 9 create error err is %d\n",err);
 
 		fib_rebalance(fi);
 	}
@@ -1550,6 +1563,7 @@ link_it:
 		ofi->fib_treeref++;
 		return ofi;
 	}
+	KPATCH_PRINTK("[fib_create_info]: 10 create error err is %d\n",err);
 
 	fi->fib_treeref++;
 	refcount_set(&fi->fib_clntref, 1);
@@ -1577,6 +1591,7 @@ link_it:
 		} endfor_nexthops(fi)
 	}
 	spin_unlock_bh(&fib_info_lock);
+	KPATCH_PRINTK("[fib_create_info]: 11 create error err is %d\n",err);
 	return fi;
 
 err_inval:
@@ -1587,6 +1602,7 @@ failure:
 		fi->fib_dead = 1;
 		free_fib_info(fi);
 	}
+	KPATCH_PRINTK("[fib_create_info]: 12 create error err is %d\n",err);
 
 	return ERR_PTR(err);
 }
diff -Nupr src.orig/net/ipv4/fib_trie.c src/net/ipv4/fib_trie.c
--- src.orig/net/ipv4/fib_trie.c	2021-11-17 22:21:44.014307880 -0500
+++ src/net/ipv4/fib_trie.c	2021-11-17 22:22:20.544366989 -0500
@@ -532,6 +532,7 @@ static struct key_vector *replace(struct
 	return tp;
 }
 
+__attribute__((optimize("-fno-optimize-sibling-calls")))
 static struct key_vector *inflate(struct trie *t,
 				  struct key_vector *oldtnode)
 {
@@ -628,6 +629,7 @@ notnode:
 	return NULL;
 }
 
+__attribute__((optimize("-fno-optimize-sibling-calls")))
 static struct key_vector *halve(struct trie *t,
 				struct key_vector *oldtnode)
 {
@@ -1200,6 +1202,7 @@ static void fib_remove_alias(struct trie
 			     struct key_vector *l, struct fib_alias *old);
 
 /* Caller must hold RTNL. */
+#include "kpatch-macros.h"
 int fib_table_insert(struct net *net, struct fib_table *tb,
 		     struct fib_config *cfg, struct netlink_ext_ack *extack)
 {
@@ -1221,11 +1224,14 @@ int fib_table_insert(struct net *net, st
 
 	pr_debug("Insert table=%u %08x/%d\n", tb->tb_id, key, plen);
 
+	KPATCH_PRINTK("[fib_table_insert]: start\n");
 	fi = fib_create_info(cfg, extack);
 	if (IS_ERR(fi)) {
 		err = PTR_ERR(fi);
+		KPATCH_PRINTK("[fib_table_insert]: create error err is %d\n",err);
 		goto err;
 	}
+	KPATCH_PRINTK("[fib_table_insert]: cross\n");
 
 	l = fib_find_node(t, &tp, key);
 	fa = l ? fib_find_alias(&l->leaf, slen, tos, fi->fib_priority,
